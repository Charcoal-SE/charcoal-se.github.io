<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>
    Guidance for Blacklisting and Watching | Charcoal
    
  </title>
  <link type="text/css" rel="stylesheet" href="/assets/application-246c1429bdd26544d97cac0305ef38e82170d25f6012981a46fe9d1901d56911.css">
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=default,fetch"></script>
  <script>window.algoliaLogoHTML = '<img src="/assets/search-by-algolia-f11921c9ad37d8af1d526ce35d9994eb44ad34b8229c1714edbf5cef12f804dc.svg" height="16" alt="Search by Algolia" width="168">'</script>
  <script type="text/javascript" src="/assets/application-678e5bc73276f2c4a030350cf70f2a32f496473871f3004a00e5ab64924f2670.js"></script>
  <script type="text/javascript" src="/assets/vendor-ecc837bbd5d3e5dbfb38524f3faaf1406e7e5490330a1bd2b4728be17a5fffa7.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon"
            type="image/png"
            href="/assets/charcoal-fd5b673dc87bbcf444be78adbf43a1198e981d2133de0a3eab4810ca047efbb7.png" />
</head>
<body>
  <div class="body-container">
    
    <div class="header">
      <div class="header-icon text-center">
        <a href="/">
          <img src="/assets/charcoal-fd5b673dc87bbcf444be78adbf43a1198e981d2133de0a3eab4810ca047efbb7.png" height="64" width title="Charcoal: spam-crusaders of the Internet" alt="charcoal.png">
          <span class="title">
            <span>Charcoal</span>
            <small>spam-crusaders of the Internet</small>
          </span>
        </a>
        <label class="nav-toggle-icon fa fa-bars fa-lg" for="nav-toggle"></label>
      </div>
      <input type="checkbox" id="nav-toggle">
      <nav class="text-center top-nav">
        <div class="search-nav">
          <i class="fa fa-search search-icon inline-icon fa-fw"></i>
          <input type="text" placeholder="Search…" id="search-input">
          <a href="#" id="search-close" class="inline-icon close-icon"><i class="fa fa-times fa-fw"></i></a>
        </div>
        <ul class="main-nav">
          <li><a href="/"><i class="fa fa-home" title="Home"></i><span class="mobile-only"> Home</span></a></li>
          <li><a href="https://chat.stackexchange.com/rooms/11540/charcoal-hq"><i class="fa mobile-only fa-comments-o"></i> chat</a></li>
          <li>
            <label class="link" for="projects-toggle">
              more projects <i class="fa fa-chevron-down"></i>
            </label>
            <input type="checkbox" id="projects-toggle">
            <nav class="nav-dropdown">
              <a href="https://metasmoke.erwaysoftware.com/" >metasmoke</a>
            
              <a href="https://charcoal-se.org/ms-urls" >metasmoke URL converter</a>
            
              <a href="https://charcoal-se.org/blaze" data-turbolinks="false">Blaze</a>
            </nav>
          </li>
          <li><a href="/scripts"><i class="fa mobile-only fa-file-code-o"></i> userscripts</a></li>
          <li><a href="/smokey/"><i class="fa mobile-only fa-file-text-o"></i> wiki</a></li>
          <li>
            <a href="/ms/API-Documentation-(V2)"><i class="fa mobile-only fa-book"></i> api</a>
            (<a href="/ms/API-Documentation-(V1)">v1</a>)
          </li>
          <li><a href="https://github.com/Charcoal-SE" title="GitHub organization"><i class="fa fa-github"></i><span class="mobile-only"> GitHub</span></a></li>
          <li><a href="#" class="search-link"><i class="fa fa-search" title="Search"></i><span class="mobile-only"> Search</span></a></li>
        </ul>
      </nav>
    </div>
    <div class="body">
      


<h1 id="guidance-for-blacklisting-and-watching">Guidance for Blacklisting and Watching</h1>

<p>Blacklisting or watching a keyword or a web site address cause the spam detection bot SmokeDetector to trigger an alert whenever that keyword or web site address appears in a post.  In other words, it basically says that any post containing this expression is spam, or at least suspicious.</p>

<h2 id="the-website-blacklist">The Website Blacklist</h2>

<p>The website blacklist consists of a list of websites associated with known spam that automatically raise suspicion when posted anywhere on Stack Exchange.</p>

<p>Blacklisting a website makes SmokeDetector report every post that is posted or modified with a link to the website (formatted as a link or otherwise) in its text.</p>

<p>The website blacklist is maintained in the <a href="https://github.com/Charcoal-SE/SmokeDetector">SmokeDetector GitHub repository</a>, specifically in the file <a href="https://github.com/Charcoal-SE/SmokeDetector/blob/master/blacklisted_websites.txt">blacklisted_websites.txt</a>.</p>

<h2 id="the-keyword-blacklist">The Keyword Blacklist</h2>

<p>The keyword blacklist consists of a list of regular expressions which are frequently seen in spam, and only very rarely outside of spam posts.</p>

<p>Blacklisting a “keyword” (which can actually be a regular expression matching a phrase or a more-complex expression with alternatives, like <code class="language-plaintext highlighter-rouge">find (?:true )?love</code> which matches either of “find love” or “find true love”) causes any post which matches it to be reported as probable spam by SmokeDetector.  Matches are not reported in the middle of a word; the keyword expression “dog” does not match “doggone” or “endogenous”.</p>

<p>The keyword blacklist is maintained in the <a href="https://github.com/Charcoal-SE/SmokeDetector">SmokeDetector GitHub repository</a>, specifically in the file <a href="https://github.com/Charcoal-SE/SmokeDetector/blob/master/bad_keywords.txt">bad_keywords.txt</a>.</p>

<h2 id="watch-expressions">Watch Expressions</h2>

<p>“Watching” an expression causes SmokeDetector to report it just like a blacklist expression, but the rule weight is kept at one, in order to prevent matches from triggering autoflagging. The watchlist is considered an “experimental” detection reason. Posts which are detected for only “experimental” reasons are reported into only a limited set of chat rooms, because each room has to opt-in to receiving reports with only experimental detections. All reports are always sent to Charcoal HQ. That means you can use <code class="language-plaintext highlighter-rouge">!!/watch</code> to try out different patterns experimentally, just to get an idea of what sorts of posts match a particular expression.</p>

<p>The list of watched expressions is maintained in the <a href="https://github.com/Charcoal-SE/SmokeDetector">SmokeDetector GitHub repository</a>, specifically in the file <a href="https://github.com/Charcoal-SE/SmokeDetector/blob/master/watched_keywords.txt">watched_keywords.txt</a>.  The format is slightly different from the other similar files; each entry is a tab-delimited record which includes a date stamp (expressed as Unix epoch, i.e. seconds since midnight Jan 1 1970 UTC), the user name of the person who added the expression, and the regular expression to watch for.</p>

<h2 id="rules-for-blacklisting-and-watching">Rules for Blacklisting and Watching</h2>

<p>We have established the following rules for watching and blacklisting.</p>

<ul>
  <li><strong>Blacklisted websites:</strong> reserved for sites which we are highly confident that are used only in spam. You may add a site to this list if <em>one of</em> the following is true.
    <ul>
      <li>The site has at least five true positive hits in metasmoke, with no false positive hits; and at least one of those true positive hits is both below the default autoflagging threshold weight (currently, 280) and is not older than six months.</li>
      <li>The site has at least three hits in metasmoke, with no false positives, <em>and</em> it is part of a preexisting campaign. (See below.)</li>
      <li>There are more than twenty hits in the last six months, and no false positives.</li>
      <li>There are recent hits, and more than 30 hits overall, and no false positives.</li>
    </ul>
  </li>
  <li><strong>Blacklisted keywords:</strong> reserved for phrases which we are highly confident that are used only in spam.  You may add a phrase to this list if the following is true.
    <ul>
      <li>The phrase has been used repeatedly in recent spam, has no false positives in metasmoke, and searching on Stack Exchange indicates that it is not a common phrase on any site in the network. When searching on Stack Exchange, you need to search <a href="https://stackexchange.com/search">in text</a>, <a href="https://stackexchange.com/search?q=url%3A">in URLs</a>, and <a href="https://stackexchange.com/search?q=code%3A">in code</a>. It must also meet similar true positive and false positive requirements as are in place for blacklisted websites.</li>
    </ul>
  </li>
  <li><strong>Watched keywords:</strong> anything is game, but be prepared to have it removed if circumstances require it.
    <ul>
      <li>We will be removing patterns periodically; you can reduce the risk of having useful patterns removed by proactively removing patterns you no longer are interested in, or which produce very uncertain value.</li>
      <li>Autoflagging weight for this reason is technically forced to stay at 1.</li>
      <li>SmokeDetector will regard these rules as “experimental”; it will not alert in rooms other than Charcoal HQ and rooms that have specifically opted to receive reports for “experimental” reasons, if there are hits solely from this set of rules.</li>
    </ul>
  </li>
</ul>

<h3 id="preexisting-campaign">Preexisting Campaign</h3>

<p>The criteria for blacklisting a web site is relaxed when the site is promoted in spam posts which we identify as being part of a “preexisting campaign”. This means the spam posts containing the web site can be directly tied to other recent spam posts which contain campaign-specific blacklisted web sites which already fulfill the stricter blacklisting criteria (i.e. not just generic blacklisted terms like “keto”).  In practice, this helps us trigger blacklisting early for sites which are clearly part of a series of spam from the same, or closely associated, spammers, where we can be reasonably sure that the only purpose of the site is to have a different URL than the other sites used in the preexisting campaign. (This is called “snowshoe spamming” – the tactic is to spread your footprint across many sites so as to evade trivial duplicate detection.)</p>

<p>Some common criteria for establishing a campaign include:</p>

<ul>
  <li>The same product name has been promoted recently by a known spammer.
    <ul>
      <li>Obviously, generic promotions for common products are not sufficient.
But e.g. a product which was unknown until recently and is now visible in posts from several accounts qualify.</li>
    </ul>
  </li>
  <li>The same IP address is connected exclusively to spam domains.
    <ul>
      <li>Note that some IP addresses (e.g. Shopify, AWS) are shared between a large number of domains;
it is not sufficient that a few of those are also spam domains.
But a common spam hosting pattern is that a single IP address is only seen in spam posts with several different domain names.</li>
    </ul>
  </li>
  <li>The same spam post (or user account on Stack Exchange, or etc) also links to an already blacklisted domain name.</li>
</ul>

<p>The intent is to enable us to fast-track blacklisting when there is clear evidence that the new domain name (or product name, etc) is a sock puppet of an already known spammer, i.e. we can reasonably establish that it was basically created to evade any blacklisting or other negative reputation associated with another account.</p>

<h2 id="how-to-blacklist-or-watch-something">How to Blacklist or Watch Something</h2>

<p>You will want to test that the expression you want to blacklist or watch isn’t already covered by one of the existing patterns.</p>

<p>You can use <code class="language-plaintext highlighter-rouge">!!/bisect &lt;string to test&gt;</code> to test to see if the text is matched by an existing watch or blacklist entry, and find out what that entry is. <code class="language-plaintext highlighter-rouge">!!/bisect</code> only tests against the patterns contained in the lists maintained with the <code class="language-plaintext highlighter-rouge">!!/watch</code> and <code class="language-plaintext highlighter-rouge">!!/blacklist-*</code> commands. You can test the string for matching all detections by using the <code class="language-plaintext highlighter-rouge">!!/test &lt;string to test&gt;</code> command (or <code class="language-plaintext highlighter-rouge">!!/test-a &lt;string to test&gt;</code> to test as an answer). The <code class="language-plaintext highlighter-rouge">!!/test</code> commands will also test against some blacklist and watchlist entries which are contained in findspam.py.</p>

<p>Everyone with SmokeDetector privileges (if you don’t have those and would like them, read up on <a href="Privileges">how to get them</a>) can blacklist a website, though this will need to be approved by someone with code privileges if you don’t already have them. Additions to the blacklist must be valid regular expressions (regex). In reality that means for largely exact matches (like the website blacklist) that you ensure that special characters (like <code class="language-plaintext highlighter-rouge">.</code>) are escaped. (Example: <code class="language-plaintext highlighter-rouge">thisisspam\.com</code>)</p>

<p>There are two methods to add a website to a watch list or blacklist:</p>

<ul>
  <li>
    <p>Propose a change to the relevant file on GitHub and create a pull request specifying why you want to blacklist the website.</p>
  </li>
  <li>
    <p>Use the pertinent chat command in any of the Smoke Detector chatrooms. This will create a pull request containing your change for you.</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">!!/blacklist-website &lt;regex&gt;</code> to blacklist a web site</li>
      <li><code class="language-plaintext highlighter-rouge">!!/blacklist-keyword &lt;regex&gt;</code> to blacklist a keyword expression</li>
      <li><code class="language-plaintext highlighter-rouge">!!/blacklist-number &lt;number&gt;</code> to blacklist a phone number (not things like URL path fragments, which can’t be obfuscated; use !!/blacklist-keyword for those)</li>
      <li><code class="language-plaintext highlighter-rouge">!!/blacklist-username &lt;regex&gt;</code> to blacklist a username (display name)</li>
      <li><code class="language-plaintext highlighter-rouge">!!/watch &lt;regex&gt;</code> to add something to the watch list (keywords, web sites, and usernames)</li>
      <li><code class="language-plaintext highlighter-rouge">!!/watch-number &lt;number&gt;</code> to add a phone number to the watch list (not things like URL path fragments, which can’t be obfuscated; use !!/watch for those)</li>
    </ul>
  </li>
</ul>

<p>If you’re blacklisting or watching a complex regex to match a whole bunch of different stuff, it’s probably better off in the pattern-matching section of <code class="language-plaintext highlighter-rouge">findspam.py</code>. You’ll need to propose a change to the file on GitHub for this; ask for help if you’re unsure what to do. However, if you think something might be appropriate for the pattern-matching section of <code class="language-plaintext highlighter-rouge">findspam.py</code>, it’s reasonable to put it on the watchlist first, so we can collect data as to how accurate it is, without giving extra weight to something that might catch a lot of false positive posts.</p>


<div class="sidebar">



<p><strong><a href="//github.com/Charcoal-SE/SmokeDetector/wiki/Guidance-for-Blacklisting-and-Watching/_edit"><i class="fa fa-pencil"></i> Edit on GitHub</a></strong></p>

<div class="sidebar-content sidebar-content-smokey">

  <p><strong><a href="Home">Home</a></strong></p>

  <p><strong><a href="http://chat.stackexchange.com/rooms/11540/charcoal-hq">Charcoal HQ</a></strong></p>

  <p><strong><a href="http://charcoal-se.org/">Charcoal Website</a></strong></p>

  <p><strong><a href="https://metasmoke.erwaysoftware.com">metasmoke</a></strong></p>

  <p><strong><a href="https://github.com/Charcoal-SE/userscripts">Userscripts</a></strong></p>

</div>


</div>


<div class="footer footer-insert text-center">
<p>Smokey is made with &lt;3 by the <a href="https://charcoal-se.org/people.html">Charcoal Team</a> and the other awesome <a href="https://github.com/Charcoal-SE/SmokeDetector/graphs/contributors">contributors</a> from <a href="https://chat.stackexchange.com/rooms/11540/charcoal-hq">Charcoal HQ</a>.</p>
</div>

    </div>
    <div class="footer text-center">
      <p>Charcoal is not affiliated with or sponsored by Stack Exchange, Inc.<br />
        <a href="/security">Security</a> • <a href="/pings/">Contact</a>
      </p>
      <p>
        <a href="https://github.com/Charcoal-SE/charcoal-se.github.io">Website Source</a>
        • By
          
            <a href="https://github.com/j-f1" class="avatar-link">
              <img class="avatar avatar-small" alt="j-f1" width="16" height="16" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/j-f1?v=3&s=16" srcset="https://avatars2.githubusercontent.com/j-f1?v=3&s=16 1x, https://avatars2.githubusercontent.com/j-f1?v=3&s=32 2x, https://avatars2.githubusercontent.com/j-f1?v=3&s=48 3x, https://avatars2.githubusercontent.com/j-f1?v=3&s=64 4x" />j-f1</a>,
          
            <a href="https://github.com/ArtOfCode-" class="avatar-link">
              <img class="avatar avatar-small" alt="ArtOfCode-" width="16" height="16" data-proofer-ignore="true" src="https://avatars2.githubusercontent.com/ArtOfCode-?v=3&s=16" srcset="https://avatars2.githubusercontent.com/ArtOfCode-?v=3&s=16 1x, https://avatars2.githubusercontent.com/ArtOfCode-?v=3&s=32 2x, https://avatars2.githubusercontent.com/ArtOfCode-?v=3&s=48 3x, https://avatars2.githubusercontent.com/ArtOfCode-?v=3&s=64 4x" />ArtOfCode-</a>,
          
            <a href="https://github.com/iBug" class="avatar-link">
              <img class="avatar avatar-small" alt="iBug" width="16" height="16" data-proofer-ignore="true" src="https://avatars0.githubusercontent.com/iBug?v=3&s=16" srcset="https://avatars0.githubusercontent.com/iBug?v=3&s=16 1x, https://avatars0.githubusercontent.com/iBug?v=3&s=32 2x, https://avatars0.githubusercontent.com/iBug?v=3&s=48 3x, https://avatars0.githubusercontent.com/iBug?v=3&s=64 4x" />iBug</a>,
          
            <a href="https://github.com/angussidney" class="avatar-link">
              <img class="avatar avatar-small" alt="angussidney" width="16" height="16" data-proofer-ignore="true" src="https://avatars1.githubusercontent.com/angussidney?v=3&s=16" srcset="https://avatars1.githubusercontent.com/angussidney?v=3&s=16 1x, https://avatars1.githubusercontent.com/angussidney?v=3&s=32 2x, https://avatars1.githubusercontent.com/angussidney?v=3&s=48 3x, https://avatars1.githubusercontent.com/angussidney?v=3&s=64 4x" />angussidney</a>,
          
          and
          <a href="https://github.com/Charcoal-SE/charcoal-se.github.io/graphs/contributors">
            20 more</a>
        
          • <a href="/code">More gory details</a>
        
      </p>
      
    </div>
  </div>
  <script>
    window.searchConfig = {
      appId: 'TMPUB31BTZ',
      key: 'c63c2f79258f929439376cfb88862440',
      index: 'main-search',
      baseUrl: '',
    }
    window.redirects = { "/channel": "https://stackoverflow.com/c/charcoal", "/m": "https://metasmoke.erwaysoftware.com", "/store": "https://www.zazzle.co.uk/charcoal_se/products", "/ms/Home": "https://charcoal-se.org//ms/", "/ms/Home": "https://charcoal-se.org//ms/", "/announcements": "https://charcoal-se.org//announcements/", "/smokey/Home": "https://charcoal-se.org//smokey/", "/smokey/Home": "https://charcoal-se.org//smokey/", "/userscripts/": "https://charcoal-se.org//scripts.html", "/userscripts": "https://charcoal-se.org//scripts.html",  }
  </script>
  <!-- Hotjar Tracking Code for charcoal-se.org -->
  <script>
    (function(h,o,t,j,a,r){
      h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:771814,hjsv:6};
      a=o.getElementsByTagName('head')[0];
      r=o.createElement('script');r.async=1;
      r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
      a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
</body>
</html>
